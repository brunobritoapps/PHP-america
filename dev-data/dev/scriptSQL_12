/****** Script for SelectTopNRows command from SSMS  ******/


--LIBERACAO DE TITULOS
UPDATE P12_PRODUCAO.dbo.SE2010
SET E2_XPRTLIB = '1'
WHERE E2_NUM = '000000301'

--RD1012
--SELECT TITULOS PARA APROVAR
USE [AMR_P00_PRODUCAO]
SELECT *
  FROM dbo.processo_vwAprovFinTitulosParaAprovar AS vw_T
  ORDER BY vw_T.status,vw_T.vencimento DESC

--SELECT FILTRO TITULO PARA APROVAR
USE [AMR_P00_PRODUCAO]
SELECT *
  FROM dbo.processo_vwAprovFinTitulosParaAprovar AS vw_T
  WHERE vw_T.codigo='01   000000060 NF 00041101'
  ORDER BY vw_T.status,vw_T.vencimento DESC

--SELECT TITULOS PARA APROVADOS
USE [AMR_P00_PRODUCAO]
SELECT *
  FROM dbo.processo_vwAprovFinTitulosAprovados AS vw_T
  ORDER BY vw_T.vencimento DESC

--SELECT ITENS DO TITULO
USE [AMR_P00_PRODUCAO]
SELECT *
  FROM dbo.processo_vwAprovFinTitulosItens AS vw_I
  WHERE vw_I.codigo='01   000000060 NF 00041101'
  ORDER BY vw_I.item DESC


--SELECT DOCUMENTO DO TITULO  teste-1
USE [AMR_P00_PRODUCAO]
SELECT *
  FROM dbo.processo_vwAprovFinTitulosDocumentos AS vw_D
  WHERE vw_D.E2_NUM='000000060'


--SELECT DOCUMENTO DO TITULO
USE [AMR_P00_PRODUCAO]
SELECT *
	 FROM dbo.processo_vwAprovFinTitulosParaAprovar AS vw_T
	 LEFT JOIN dbo.processo_vwAprovFinTituloDocumentos AS vw_D ON vw_D.numero=vw_T.E2_NUM

--SELECT DOCUMENTO DO TITULO  teste-2
USE [AMR_P00_PRODUCAO]
SELECT DISTINCT *
  FROM dbo.processo_vwAprovFinTituloDocumentos AS vw_D
  WHERE vw_D.numero='000000060'



--SET STATUS DE TITULO - SOLICITAR MAIS DETALHES = PARA ANALISE
USE [P12_PRODUCAO]
UPDATE P12_PRODUCAO.dbo.SE2010
SET E2_XPRTLIB = '2'
   ,E2_DATALIB = ''
WHERE E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA = '011  000000045 NF 00125301'
AND E2_XPRTLIB='1'


--SET STATUS DE TITULO - APROVAR = APROVADOS
USE [P12_PRODUCAO]
UPDATE [P12_PRODUCAO].dbo.SE2010
SET E2_XPRTLIB = '3'
   ,E2_DATALIB = CONVERT(varchar, GETDATE() ,112)
WHERE E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA = '011  000000045 NF 00125301'



-- SELECT HISTORICO
Select DISTINCT Top 1000 
		--SUM(Total) Valor,
	    --Count(Item) QtdItens,
		
		LEFT(CONVERT(VARCHAR,CONVERT(DATE,vw_H.Emissao), 105), 10) AS Emissao
	    ,FORMAT (vw_H.Total, 'c', 'pt-br')  AS valor
		--, Numero
		,*
	    From dbo.processo_vwAprovHistorico AS vw_H
	    --Where Codigo + Loja = '000411'+'01'
	    --Group By Emissao, Numero
		WHERE CONVERT(DATE,vw_H.Emissao) < GETDATE()
		AND Codigo + Loja = '001227'+'01'
	    Order by vw_H.Emissao Desc


--APROVACAO DE TITULOS
USE [P12_PRODUCAO]
UPDATE SE2010
SET E2_XPRTLIB = '3'
   ,E2_DATALIB = CONVERT(varchar, GETDATE() ,112)
WHERE E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA = '011  000000332 NF 00020801'
--01   000446492 NF 00114802
--01   0000309972TX UNIAO 00
--01   012019    FOL00067501
--014  000201062 NF 00062501



 --SET STATUS DE TITULO - LIBERACAO - SOLICITAR MAIS DETALHES = EM ANALISE
USE [P12_PRODUCAO]
UPDATE SE2010
SET E2_XPRTLIB = '2'
WHERE E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA = '011  000000045 NF 00125301'
AND E2_XPRTLIB='1'
--011  000000045 NF 00125301
--011  000000332 NF 00020801

 --SET STATUS DE TITULO - PARA APROVAR
USE [P12_PRODUCAO]
UPDATE SE2010
SET E2_XPRTLIB = '1'
,E2_DATALIB=''
WHERE E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA ='011  000000045 NF 00125301'
--01   000000060 NF 00041101
--01   000003671 NF 00006001




SELECT
   REPLACE(SM.M0_NOME,'AMERICA','') AS pagadora
  ,CONVERT(VARCHAR(10),CONVERT(DATE,E5_DATA,105),105) AS  data
  ,A2.A2_NOME AS beneficiario
  ,E5_TIPO AS tipo
  ,FORMAT (E5_VALOR, 'c', 'pt-br') as valor
  ,RTRIM(ED_DESCRIC) AS natureza
  ,E5_HISTOR AS observacoes
FROM [P12_PRODUCAO].[dbo].[SE5010]
  LEFT JOIN [P12_PRODUCAO].[dbo].[SED010] AS ED ON ED_CODIGO=E5_NATUREZ
  LEFT JOIN [P12_PRODUCAO].[dbo].[SA2010] AS A2 ON A2.A2_COD = E5_FORNECE
  LEFT JOIN [P12_PRODUCAO].[dbo].[SM0010] AS SM ON SM.M0_CODIGO+M0_CODFIL='01'+A2.A2_LOJA
WHERE E5_BENEF LIKE'%A. BASTOS JUNIOR ME %'
      AND E5_RECPAG='P'
ORDER BY CONVERT(DATE,E5_DATA,105) DESC




SELECT TOP 2 *
    FROM processo_vwAprovFinHistoricoPagamentos AS h
    WHERE h.A2_COD=?
    ORDER BY CONVERT(DATE,h.data,105) DESC








