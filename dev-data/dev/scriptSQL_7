USE [AMR_P00_PRODUCAO]
GO
CREATE VIEW processo_vwAprovaFinItem AS

SELECT
'01'+E2_FILIAL AS Empresa,
E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA Codigo,
'FI ' Tipo,
D1_ITEM AS Item,
D1_COD AS Codigo_Produto,
B1_DESC AS Produto,
D1_TOTAL - D1_VALDESC AS Total
FROM P12_PRODUCAO..SE2010 SE2
JOIN P12_PRODUCAO..SA2010 SA2 ON A2_FILIAL=' ' AND A2_COD=E2_FORNECE AND A2_LOJA=E2_LOJA AND SA2.D_E_L_E_T_=' '
LEFT JOIN P12_PRODUCAO..SF1010 SF1 ON F1_FILIAL=E2_FILIAL AND F1_DOC=E2_NUM AND F1_SERIE=E2_PREFIXO AND F1_FORNECE=E2_FORNECE AND F1_LOJA=E2_LOJA AND SF1.D_E_L_E_T_=' '
LEFT JOIN P12_PRODUCAO..SD1010 SD1 ON D1_FILIAL=F1_FILIAL AND D1_DOC=F1_DOC AND D1_SERIE=F1_SERIE AND D1_FORNECE=F1_FORNECE AND D1_LOJA=F1_LOJA AND SD1.D_E_L_E_T_=' '
--DESPESAS
LEFT JOIN P12_PRODUCAO..SB1010 SB1 ON B1_FILIAL=' ' AND B1_COD=D1_COD AND SB1.D_E_L_E_T_=' '
WHERE E2_FILIAL BETWEEN '01' AND '02'
AND E2_SALDO > 0
AND SE2.D_E_L_E_T_=' '
AND E2_DATALIB=' '

UNION ALL

SELECT
'02'+E2_FILIAL AS Empresa,
E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA Codigo,
'FI ' Tipo,
D1_ITEM AS Item,
D1_COD AS Codigo_Produto,
B1_DESC AS Produto,
D1_TOTAL - D1_VALDESC AS Total
FROM P12_PRODUCAO..SE2020 SE2
JOIN P12_PRODUCAO..SA2010 SA2 ON A2_FILIAL=' ' AND A2_COD=E2_FORNECE AND A2_LOJA=E2_LOJA AND SA2.D_E_L_E_T_=' '
LEFT JOIN P12_PRODUCAO..SF1010 SF1 ON F1_FILIAL=E2_FILIAL AND F1_DOC=E2_NUM AND F1_SERIE=E2_PREFIXO AND F1_FORNECE=E2_FORNECE AND F1_LOJA=E2_LOJA AND SF1.D_E_L_E_T_=' '
LEFT JOIN P12_PRODUCAO..SD1010 SD1 ON D1_FILIAL=F1_FILIAL AND D1_DOC=F1_DOC AND D1_SERIE=F1_SERIE AND D1_FORNECE=F1_FORNECE AND D1_LOJA=F1_LOJA AND SD1.D_E_L_E_T_=' '
--DESPESAS
LEFT JOIN P12_PRODUCAO..SB1010 SB1 ON B1_FILIAL='  ' AND B1_COD=D1_COD AND SB1.D_E_L_E_T_=' '
WHERE E2_FILIAL BETWEEN '01' AND '02'
AND E2_SALDO > 0
AND SE2.D_E_L_E_T_=' '
AND E2_DATALIB=' '

UNION ALL

SELECT
'03'+E2_FILIAL AS Empresa,
E2_FILIAL+E2_PREFIXO+E2_NUM+E2_PARCELA+E2_TIPO+E2_FORNECE+E2_LOJA Codigo,
'FI ' Tipo,
D1_ITEM AS Item,
D1_COD AS Codigo_Produto,
B1_DESC AS Produto,
D1_TOTAL - D1_VALDESC AS Total
FROM P12_PRODUCAO..SE2030 SE2
JOIN P12_PRODUCAO..SA2010 SA2 ON A2_FILIAL=' ' AND A2_COD=E2_FORNECE AND A2_LOJA=E2_LOJA AND SA2.D_E_L_E_T_=' '
LEFT JOIN P12_PRODUCAO..SF1010 SF1 ON F1_FILIAL=E2_FILIAL AND F1_DOC=E2_NUM AND F1_SERIE=E2_PREFIXO AND F1_FORNECE=E2_FORNECE AND F1_LOJA=E2_LOJA AND SF1.D_E_L_E_T_=' '
LEFT JOIN P12_PRODUCAO..SD1010 SD1 ON D1_FILIAL=F1_FILIAL AND D1_DOC=F1_DOC AND D1_SERIE=F1_SERIE AND D1_FORNECE=F1_FORNECE AND D1_LOJA=F1_LOJA AND SD1.D_E_L_E_T_=' '
--DESPESAS
LEFT JOIN P12_PRODUCAO..SB1010 SB1 ON B1_FILIAL='  ' AND B1_COD=D1_COD AND SB1.D_E_L_E_T_=' '
WHERE E2_FILIAL BETWEEN '01' AND '02'
AND E2_SALDO > 0
AND SE2.D_E_L_E_T_=' '
AND E2_DATALIB=' '

go



